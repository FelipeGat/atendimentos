<?php\n/**\n * Script de Backup de Clientes\n * Sistema de Gerenciamento de Atendimentos\n * \n * Este script cria um backup dos dados de clientes antes de executar testes.\n * Deve ser executado antes de testes de CRUD em ambiente de produção.\n */\n\nrequire_once __DIR__ . '/backend/config/db.php';\n\n// Nome do arquivo de backup\n$backupFileName = 'backup_clientes_' . date('Y-m-d_H-i-s') . '.sql';\n$backupPath = __DIR__ . '/backend/backups/' . $backupFileName;\n\n// Criar diretório de backups se não existir\n$backupDir = dirname($backupPath);\nif (!file_exists($backupDir)) {\n    mkdir($backupDir, 0755, true);\n}\n\n// Consulta para obter todos os clientes\n$query = \"SELECT * FROM clientes ORDER BY id\";\n$result = $conn->query($query);\n\nif (!$result) {\n    die(\"Erro na consulta: \" . $conn->error);\n}\n\n// Abrir arquivo para escrita\n$backupFile = fopen($backupPath, 'w');\n\nif (!$backupFile) {\n    die(\"Erro ao criar arquivo de backup: $backupPath\");\n}\n\n// Escrever cabeçalho do backup\nfwrite($backupFile, \"-- Backup de Clientes\\n\");\nfwrite($backupFile, \"-- Gerado em: \" . date('Y-m-d H:i:s') . \"\\n\");\nfwrite($backupFile, \"-- Ambiente: \" . ($isProduction ? 'Produção' : 'Desenvolvimento') . \"\\n\\n\");\nfwrite($backupFile, \"SET FOREIGN_KEY_CHECKS=0;\\n\\n\");\n\n// Gerar INSERTs para cada cliente\nwhile ($row = $result->fetch_assoc()) {\n    $values = [];\n    foreach ($row as $key => $value) {\n        if (is_null($value)) {\n            $values[] = 'NULL';\n        } else {\n            $values[] = \"'\" . $conn->real_escape_string($value) . \"'\";\n        }\n    }\n    \n    $sql = \"INSERT INTO clientes (\" . implode(',', array_keys($row)) . \") VALUES (\" . implode(',', $values) . \");\\n\";\n    fwrite($backupFile, $sql);\n}\n\nfwrite($backupFile, \"\\nSET FOREIGN_KEY_CHECKS=1;\\n\");\nfclose($backupFile);\n\necho \"Backup criado com sucesso: $backupPath\\n\";\necho \"Total de registros: \" . $result->num_rows . \"\\n\";\n\n// Fechar conexão\n$conn->close();\n